<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Infinispan Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="ignite-set-component.html" title="Ignite Sets Component"><link rel="next" href="influxdb-component.html" title="InfluxDB Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="infinispan-component"></a>Infinispan Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="infinispan-component.html#_uri_format_95">URI format</a></span></dt><dt><span class="section"><a href="infinispan-component.html#_uri_options_31">URI Options</a></span></dt><dt><span class="section"><a href="infinispan-component.html#_message_headers_23">Message Headers</a></span></dt><dt><span class="section"><a href="infinispan-component.html#_examples_17">Examples</a></span></dt><dt><span class="section"><a href="infinispan-component.html#_using_the_infinispan_based_idempotent_repository">Using the Infinispan based idempotent repository</a></span></dt><dt><span class="section"><a href="infinispan-component.html#_using_the_infinispan_based_route_policy">Using the Infinispan based route policy</a></span></dt><dt><span class="section"><a href="infinispan-component.html#_see_also_55">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.13</strong></span></p><p>This component allows you to interact with
<a class="link" href="http://infinispan.org/" target="_top">Infinispan</a> distributed data grid / cache.
Infinispan is an extremely scalable, highly available key/value data
store and data grid platform written in Java.</p><p>From&nbsp;<span class="strong"><strong>Camel 2.17</strong></span> onwards Infinispan requires Java 8.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-infinispan<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_95"></a>URI format</h2></div></div></div><pre class="programlisting">infinispan:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//cacheName?[options]</em></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_options_31"></a>URI Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="infinispan-component.html#_path_parameters_1_parameters_89">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="infinispan-component.html#_query_parameters_18_parameters_5">Query Parameters (18 parameters):</a></span></dt></dl></div><p>The producer allows sending messages to a local infinispan cache
configured in the registry, or to a remote cache using the HotRod
protocol. The consumer allows listening for events from local infinispan cache
accessible from the registry.</p><p>The Infinispan component supports 3 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>configuration</strong></span> (common)</p></td><td align="left" valign="top"><p>The default configuration shared among endpoints.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>InfinispanConfiguration</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>cacheContainer</strong></span> (common)</p></td><td align="left" valign="top"><p>The default cache container.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>BasicCacheContainer</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Infinispan endpoint is configured using URI syntax:</p><pre class="screen">infinispan:cacheName</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_89"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>cacheName</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The cache to use</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_18_parameters_5"></a>Query Parameters (18 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>hosts</strong></span> (common)</p></td><td align="left" valign="top"><p>Specifies the host of the cache on Infinispan instance</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>queryBuilder</strong></span> (common)</p></td><td align="left" valign="top"><p>Specifies the query builder.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>InfinispanQueryBuilder</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>clusteredListener</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If true, the listener will be installed for the entire cluster</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>command</strong></span> (consumer)</p></td><td align="left" valign="top"><p><span class="strong"><strong>Deprecated</strong></span> The operation to perform.</p></td><td align="center" valign="top"><p>PUT</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>customListener</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Returns the custom listener in use, if provided</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>InfinispanCustom Listener</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>eventTypes</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Specifies the set of event types to register by the consumer. Multiple event can be separated by comma. The possible event types are: CACHE_ENTRY_ACTIVATED, CACHE_ENTRY_PASSIVATED, CACHE_ENTRY_VISITED, CACHE_ENTRY_LOADED, CACHE_ENTRY_EVICTED, CACHE_ENTRY_CREATED, CACHE_ENTRY_REMOVED, CACHE_ENTRY_MODIFIED, TRANSACTION_COMPLETED, TRANSACTION_REGISTERED, CACHE_ENTRY_INVALIDATED, DATA_REHASHED, TOPOLOGY_CHANGED, PARTITION_STATUS_CHANGED</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sync</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If true, the consumer will receive notifications synchronously</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>operation</strong></span> (producer)</p></td><td align="left" valign="top"><p>The operation to perform.</p></td><td align="center" valign="top"><p>PUT</p></td><td align="left" valign="top"><p>InfinispanOperation</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>cacheContainer</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Specifies the cache Container to connect</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>BasicCacheContainer</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>cacheContainerConfiguration</strong></span> (advanced)</p></td><td align="left" valign="top"><p>The CacheContainer configuration</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Object</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>configurationProperties</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Implementation specific properties for the CacheManager</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>configurationUri</strong></span> (advanced)</p></td><td align="left" valign="top"><p>An implementation specific URI for the CacheManager</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>flags</strong></span> (advanced)</p></td><td align="left" valign="top"><p>A comma separated list of Flag to be applied by default on each cache invocation, not applicable to remote caches.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resultHeader</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Store the operation result in a header instead of the message body. By default, resultHeader == null and the query result is stored in the message body, any existing content in the message body is discarded. If resultHeader is set, the value is used as the name of the header to store the query result and the original message body is preserved. This value can be overridden by an in message header named: CamelInfinispanOperationResultHeader</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Object</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_headers_23"></a>Message Headers</h2></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="10%" class="col_3"><col width="10%" class="col_4"><col width="60%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default Value</th><th align="left" valign="top">Type</th><th align="left" valign="top">Context</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>CamelInfinispanCacheName</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Shared</p></td><td align="left" valign="top"><p>The cache participating in the operation or event.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanOperation</p></td><td align="left" valign="top"><p><code class="literal">PUT</code></p></td><td align="left" valign="top"><p>InfinispanOperation</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>The operation to perform.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanMap</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>Map</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>A Map to use in case of CamelInfinispanOperationPutAll operation</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanKey</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Shared</p></td><td align="left" valign="top"><p>The key to perform the operation to or the key generating the event.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanValue</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>The value to use for the operation.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanEventType</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Consumer</p></td><td align="left" valign="top"><p>The type of the received event. Possible values defined here org.infinispan.notifications.cachelistener.event.Event.Type</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanIsPre</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>Boolean</p></td><td align="left" valign="top"><p>Consumer</p></td><td align="left" valign="top"><p>Infinispan fires two events for each operation: one before and one after the operation.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanLifespanTime</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>long</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>The Lifespan time of a value inside the cache. Negative values are interpreted as infinity.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanTimeUnit</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>The Time Unit of an entry Lifespan Time.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanMaxIdleTime</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>long</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>The maximum amount of time an entry is allowed to be idle for before it is considered as expired.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanMaxIdleTimeUnit</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>The Time Unit of an entry Max Idle Time.</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanQueryBuilder</p></td><td align="left" valign="top"><p>null</p></td><td align="left" valign="top"><p>InfinispanQueryBuilder</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p><span class="strong"><strong>From Camel 2.17:</strong></span> The QueryBuilde to use for QUERY command, if not present the command defaults to InifinispanConfiguration&#8217;s one</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanIgnoreReturnValues</p></td><td align="left" valign="top"><p>null</p></td><td align="left" valign="top"><p>Boolean</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p><span class="strong"><strong>From Camel 2.17:</strong></span> If this header is set, the return value for cache operation returning something is ignored by the client application</p></td></tr><tr><td align="left" valign="top"><p>CamelInfinispanOperationResultHeader</p></td><td align="left" valign="top"><p>null</p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p><span class="strong"><strong>From Camel 2.20:</strong></span> Store the operation result in a header instead of the message body</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_examples_17"></a>Examples</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">Retrieve a specific key from the default cache using a custom cache container:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .setHeader(InfinispanConstants.OPERATION).constant(InfinispanOperation.GET)
    .setHeader(InfinispanConstants.KEY).constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"123"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"infinispan?cacheContainer=#cacheContainer"</em></strong>);</pre></li><li class="listitem"><p class="simpara">Retrieve a specific key from a named cache:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .setHeader(InfinispanConstants.OPERATION).constant(InfinispanOperation.PUT)
    .setHeader(InfinispanConstants.KEY).constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"123"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"infinispan:myCacheName"</em></strong>);</pre></li><li class="listitem"><p class="simpara">Put a value with lifespan</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .setHeader(InfinispanConstants.OPERATION).constant(InfinispanOperation.GET)
    .setHeader(InfinispanConstants.KEY).constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"123"</em></strong>)
    .setHeader(InfinispanConstants.LIFESPAN_TIME).constant(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">100L</span>)
    .setHeader(InfinispanConstants.LIFESPAN_TIME_UNIT.constant(TimeUnit.MILLISECONDS.toString())
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"infinispan:myCacheName"</em></strong>);</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_the_infinispan_based_idempotent_repository"></a>Using the Infinispan based idempotent repository</h2></div></div></div><p>In this section we will use the Infinispan based idempotent repository.</p><p>First, we need to create a cacheManager and then configure our</p><pre class="programlisting">org.apache.camel.component.infinispan.processor.idempotent.InfinispanIdempotentRepository:</pre><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- set up the cache manager --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"cacheManager"</span>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.infinispan.manager.DefaultCacheManager"</span>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">init-method</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"start"</span>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">destroy-method</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"stop"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>

<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- set up the repository --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"infinispanRepo"</span>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.infinispan.processor.idempotent.InfinispanIdempotentRepository"</span>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">factory-method</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"infinispanIdempotentRepository"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;argument</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"cacheManager"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;argument</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"idempotent"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre><p>Then we can create our Infinispan idempotent repository in the spring
XML file as well:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"JpaMessageIdRepositoryTest"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:start"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096"> /&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;idempotentConsumer</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">messageIdRepositoryRef</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"infinispanStore"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;header&gt;</strong>messageId<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/header&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:result"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096"> /&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/idempotentConsumer&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_the_infinispan_based_route_policy"></a>Using the Infinispan based route policy</h2></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_55"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li></ul></div></div></div></body></html>