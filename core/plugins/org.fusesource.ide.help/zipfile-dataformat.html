<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Zip File DataFormat</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="zip-dataformat.html" title="Zip Deflate Compression DataFormat"><link rel="next" href="zookeeper-component.html" title="ZooKeeper Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="zipfile-dataformat"></a>Zip File DataFormat</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zipfile-dataformat.html#_zipfile_options">ZipFile Options</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#_marshal_8">Marshal</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#_unmarshal_9">Unmarshal</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#_aggregate_4">Aggregate</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#_dependencies_74">Dependencies</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#Zipkin-ZipkinComponent">Zipkin Component</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#camel-zipkin-Options">Options</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#camel-zipkin-Example">Example</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#camel-zipkin-Mappingrules">Mapping rules</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#camel-zipkin-camel-zipin-starter">camel-zipin-starter</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.11</strong></span></p><p>The Zip File Data Format is a message compression
and de-compression format. Messages can be marshalled (compressed) to
Zip files containing a single entry, and Zip files containing a single
entry can be unmarshalled (decompressed) to the original file contents.
This data format supports ZIP64, as long as Java 7 or later is being used].</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_zipfile_options"></a>ZipFile Options</h2></div></div></div><p>The Zip File dataformat supports 4 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="10%" class="col_3"><col width="60%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>usingIterator</strong></span></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>If the zip file has more then one entry, the setting this option to true, allows to work with the splitter EIP, to split the data using an iterator in a streaming mode.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>allowEmptyDirectory</strong></span></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>If the zip file has more then one entry, setting this option to true, allows to get the iterator even if the directory is empty</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>preservePathElements</strong></span></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>If the file name contains path elements, setting this option to true, allows the path to be maintained in the zip file.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>contentTypeHeader</strong></span></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether the data format should set the Content-Type header with the type from the data format if the data format is capable of doing so. For example application/xml for data formats marshalling to XML, or application/json for data formats marshalling to JSon etc.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_marshal_8"></a>Marshal</h2></div></div></div><p>In this example we marshal a regular text/XML payload to a compressed
payload using Zip file compression, and send it to an ActiveMQ queue
called MY_QUEUE.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .marshal().zipFile()
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:queue:MY_QUEUE"</em></strong>);</pre><p>The name of the Zip entry inside the created Zip file is based on the
incoming <code class="literal">CamelFileName</code> message header, which is the standard message
header used by the file component. Additionally, the
outgoing <code class="literal">CamelFileName</code> message header is automatically set to the
value of the incoming <code class="literal">CamelFileName</code> message header, with the ".zip"
suffix. So for example, if the following route finds a file named
"test.txt" in the input directory, the output will be a Zip file named
"test.txt.zip" containing a single Zip entry named "test.txt":</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:input/directory?antInclude=*/.txt"</em></strong>)
    .marshal().zipFile()
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:output/directory"</em></strong>);</pre><p>If there is no incoming <code class="literal">CamelFileName</code> message header (for example, if
the file component is not the consumer), then the
message ID is used by default, and since the message ID is normally a
unique generated ID, you will end up with filenames like
<code class="literal">ID-MACHINENAME-2443-1211718892437-1-0.zip</code>. If you want to override
this behavior, then you can set the value of the <code class="literal">CamelFileName</code> header
explicitly in your route:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .setHeader(Exchange.FILE_NAME, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"report.txt"</em></strong>))
    .marshal().zipFile()
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:output/directory"</em></strong>);</pre><p>This route would result in a Zip file named "report.txt.zip" in the
output directory, containing a single Zip entry named "report.txt".</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_unmarshal_9"></a>Unmarshal</h2></div></div></div><p>In this example we unmarshal a Zip file payload from an ActiveMQ queue
called MY_QUEUE to its original format, and forward it for processing to
the <code class="literal">UnZippedMessageProcessor</code>.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:queue:MY_QUEUE"</em></strong>)
    .unmarshal().zipFile()
    .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> UnZippedMessageProcessor());</pre><p>If the zip file has more then one entry, the usingIterator option of
ZipFileDataFormat to be true, and you can use splitter to do the further
work.</p><pre class="programlisting">ZipFileDataFormat zipFile = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ZipFileDataFormat();
zipFile.setUsingIterator(true);

from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:src/test/resources/org/apache/camel/dataformat/zipfile/?consumer.delay=1000&amp;noop=true"</em></strong>)
    .unmarshal(zipFile)
    .split(body(Iterator.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)).streaming()
        .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> UnZippedMessageProcessor())
    .end();</pre><p>Or you can use the ZipSplitter as an expression for splitter directly
like this</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:src/test/resources/org/apache/camel/dataformat/zipfile?consumer.delay=1000&amp;noop=true"</em></strong>)
    .split(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ZipSplitter()).streaming()
        .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> UnZippedMessageProcessor())
    .end();</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_aggregate_4"></a>Aggregate</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that this aggregation strategy requires eager completion check to work properly.</p></td></tr></table></div><p>In this example we aggregate all text files found in the input directory
into a single Zip file that is stored in the output directory.&nbsp;</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:input/directory?antInclude=*/.txt"</em></strong>)
    .aggregate(constant(true), <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ZipAggregationStrategy())
        .completionFromBatchConsumer().eagerCheckCompletion()
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:output/directory"</em></strong>);</pre><p>The outgoing&nbsp;<code class="literal">CamelFileName</code>&nbsp;message header is created using
java.io.File.createTempFile, with the ".zip" suffix.&nbsp;If you want to
override this behavior, then you can set the value of
the&nbsp;<code class="literal">CamelFileName</code>&nbsp;header explicitly in your route:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:input/directory?antInclude=*/.txt"</em></strong>)
    .aggregate(constant(true), <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ZipAggregationStrategy())
        .completionFromBatchConsumer().eagerCheckCompletion()
        .setHeader(Exchange.FILE_NAME, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"reports.zip"</em></strong>))
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:output/directory"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dependencies_74"></a>Dependencies</h2></div></div></div><p>To use Zip files in your camel routes you need to add a dependency on
<span class="strong"><strong>camel-zipfile</strong></span> which implements this data format.</p><p>If you use Maven you can just add the following to your <code class="literal">pom.xml</code>,
substituting the version number for the latest &amp; greatest release (see
the download page for the latest versions).</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-zipfile<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Zipkin-ZipkinComponent"></a>Zipkin Component</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.18</strong></span></p><p>The camel-zipkin component is used for tracing and timing incoming and
outgoing Camel messages using <a class="link" href="http://zipkin.io/" target="_top">zipkin</a>.</p><p>Events (span) are captured for incoming and outgoing messages being sent
to/from Camel.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>camel-zipkin is planned to be refactored in Camel 2.22.0 to not use zipkin-scribe
but use the default http transport. This work may cause backwards incompatibility.</p></td></tr></table></div><p>This means you need to configure which Camel endpoints map
to zipkin service names.</p><p>The mapping can be configured using:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">route id - A Camel route id</li><li class="listitem">endpoint url - A Camel endpoint url</li></ul></div><p>For both kinds you can match using wildcards and regular expressions,
using the rules from&nbsp;Intercept.</p><p>To match all Camel messages you can use * in the pattern and configure
that to the same service name.</p><p>If no mapping has been configured, Camel will fallback and use
endpoint uri&#8217;s as service names.&nbsp;
However, it&#8217;s recommended to configure service mappings so you can use
human-readable names instead of Camel&nbsp;endpoint uris in the names.</p><p>Camel will auto-configure a span reporter one hasn&#8217;t been explicitly configured,
and if the hostname and port to a zipkin collector has been configured as environment variables</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">ZIPKIN_COLLECTOR_HTTP_SERVICE_HOST - The http hostname</li><li class="listitem">ZIPKIN_COLLECTOR_HTTP_SERVICE_PORT - The port number</li></ul></div><p>or</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">ZIPKIN_COLLECTOR_THRIFT_SERVICE_HOST - The Scribe (Thrift RPC) hostname</li><li class="listitem">ZIPKIN_COLLECTOR_THRIFT_SERVICE_PORT - The port number</li></ul></div><p>This makes it easy to use camel-zipkin in container platforms where the
platform can run your application in a linux container where service
configurations are provided as environment variables.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-zipkin-Options"></a>Options</h2></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Option</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>rate</p></td><td align="left" valign="top"><p>1.0f</p></td><td align="left" valign="top"><p>Configures a rate that decides how many events should be traced by
zipkin. The rate is expressed as a percentage (1.0f = 100%, 0.5f is 50%, 0.1f is
10%).</p></td></tr><tr><td align="left" valign="top"><p>spanReporter</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><span class="strong"><strong>Mandatory:</strong></span> The reporter to use for sending zipkin span events to the
zipkin server.</p></td></tr><tr><td align="left" valign="top"><p>serviceName</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p>To use a global service name that matches all Camel events</p></td></tr><tr><td align="left" valign="top"><p>clientServiceMappings</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p>Sets the <span class="strong"><strong>client</strong></span> service mappings that matches Camel events to the
given zipkin service name. The content is a Map&lt;String, String&gt; where the key is a pattern and the
value is the service name. The pattern uses the rules from Intercept.</p></td></tr><tr><td align="left" valign="top"><p>serverServiceMappings</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p>Sets the <span class="strong"><strong>server</strong></span> service mappings that matches Camel events to the
given zipkin service name. The content is a Map&lt;String, String&gt; where the key is a pattern and the
value is the service name. The pattern uses the rules from Intercept.</p></td></tr><tr><td align="left" valign="top"><p>excludePatterns</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p>Sets exclude pattern(s) that will disable tracing with zipkin for Camel
messages that matches the pattern. The content is a Set&lt;String&gt; where the key is a pattern. The pattern
uses the rules from Intercept.</p></td></tr><tr><td align="left" valign="top"><p>includeMessageBody</p></td><td align="left" valign="top"><p>false</p></td><td align="left" valign="top"><p>Whether to include the Camel message body in the zipkin traces.
This is not recommended for production usage, or when having big
payloads. You can limit the size by configuring the
<a class="link" href="how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html" target="_top">max
debug log size</a>.&nbsp;</p></td></tr><tr><td align="left" valign="top"><p>includeMessageBodyStreams</p></td><td align="left" valign="top"><p>false</p></td><td align="left" valign="top"><p>Whether to include message bodies that are stream based in the zipkin
traces. This requires enabling streamcaching on the
routes or globally on the CamelContext. This is not recommended for production usage, or when having big
payloads. You can limit the size by configuring the
<a class="link" href="how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html" target="_top">max
debug log size</a>.&nbsp;&nbsp;</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-zipkin-Example"></a>Example</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zipfile-dataformat.html#camel-zipkin-ServiceName">ServiceName</a></span></dt><dt><span class="section"><a href="zipfile-dataformat.html#camel-zipkin-ClientandServerServiceMappings">Client and Server Service Mappings</a></span></dt></dl></div><p>To enable camel-zipkin you need to configure first</p><pre class="programlisting">ZipkinTracer zipkin = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ZipkinTracer();
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Configure a reporter, which controls how often spans are sent</em>
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//   (the dependency is io.zipkin.reporter2:zipkin-sender-okhttp3)</em>
sender = OkHttpSender.create(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"http://127.0.0.1:9411/api/v2/spans"</em></strong>);
zipkin.setSpanReporter(AsyncReporter.create(sender));
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// and then add zipkin to the CamelContext</em>
zipkin.init(camelContext);</pre><p>The configuration above will trace all incoming and outgoing
messages in Camel routes.&nbsp;</p><p>To use ZipkinTracer in XML, all you need to do is to define scribe and
zipkin tracer beans. Camel will automatically discover and use them.</p><pre class="programlisting">  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- configure how to reporter spans to a Zipkin collector
          (the dependency is io.zipkin.reporter2:zipkin-reporter-spring-beans) --&gt;</em>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"zipkin2.reporter.beans.AsyncReporterFactoryBean"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"sender"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"sender"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"zipkin2.reporter.beans.OkHttpSenderFactoryBean"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"endpoint"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://localhost:9411/api/v2/spans"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/property&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- wait up to half a second for any in-flight spans on close --&gt;</em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"closeTimeout"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"500"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong>

  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- setup zipkin tracer --&gt;</em>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"zipkinTracer"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.zipkin.ZipkinTracer"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"serviceName"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"dude"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"spanReporter"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="camel-zipkin-ServiceName"></a>ServiceName</h3></div></div></div><p>However, if you want to map Camel endpoints to human friendly logical
names, you can add mappings</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">ServiceName *</li></ul></div><p>You can configure a global service name that all events will fallback
and use, such as:</p><pre class="programlisting">zipkin.setServiceName(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"invoices"</em></strong>);</pre><p>This will use the same service name for all incoming and outgoing zipkin
traces. If your application uses different services, you should map
them to more finely grained client / server service mappings</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="camel-zipkin-ClientandServerServiceMappings"></a>Client and Server Service Mappings</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">ClientServiceMappings</li><li class="listitem">ServerServiceMappings</li></ul></div><p>If your application hosts a service that others can call, you can map
the Camel route endpoint to a server service mapping. For example,
suppose your Camel application has the following route:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:queue:inbox"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"http:someserver/somepath"</em></strong>);</pre><p>And you want to make that as a server service, you can add the following
mapping:</p><pre class="programlisting">zipkin.addServerServiceMapping(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:queue:inbox"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"orders"</em></strong>);</pre><p>Then when a message is consumed from that inbox queue, it becomes a
zipkin server event with the service name 'orders'.</p><p>Now suppose that the call to http:someserver/somepath is also a service,
which you want to map to a client service name, which can be done as:</p><pre class="programlisting">zipkin.addClientServiceMapping(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"http:someserver/somepath"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"audit"</em></strong>);</pre><p>Then in the same Camel application you have mapped incoming and outgoing
endpoints to different zipkin service names.</p><p>You can use wildcards in the service mapping. To match all outgoing
calls to the same HTTP server you can do:</p><pre class="screen">zipkin.addClientServiceMapping("http:someserver*", "audit");</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-zipkin-Mappingrules"></a>Mapping rules</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zipfile-dataformat.html#camel-zipkin-Noclientorservermappings">No client or server mappings</a></span></dt></dl></div><p>The service name mapping for server occurs using the following rules</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Is there an exclude pattern that matches the endpoint uri of the
from endpoint? If yes then skip.</li><li class="listitem">Is there a match in the serviceServiceMapping that matches the
endpoint uri of the from endpoint? If yes, then use the found service name</li><li class="listitem">Is there a match in the serviceServiceMapping that matches the route
id of the current route? If yes, then use the found service name</li><li class="listitem">Is there a match in the serviceServiceMapping that matches the
original route id where the exchange started? If yes, then use the found
service name</li><li class="listitem">No service name was found, the exchange is not traced by zipkin</li></ol></div><p>The service name mapping for client occurs using the following rules</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Is there an exclude pattern that matches the endpoint uri of the
from endpoint? If yes then skip.</li><li class="listitem">Is there a match in the clientServiceMapping that matches the
endpoint uri of endpoint where the message is being sent to? If yes, then
use the found service name</li><li class="listitem">Is there a match in the clientServiceMapping that matches the route
id of the current route? If yes, then use the found service name</li><li class="listitem">Is there a match in the clientServiceMapping that matches the
original route id where the exchange started? If yes, then use the found
service name</li><li class="listitem">No service name was found, the exchange is not traced by zipkin</li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="camel-zipkin-Noclientorservermappings"></a>No client or server mappings</h3></div></div></div><p>If there has been no configuration of client or server service mappings,
CamelZipkin runs in a fallback mode, and uses endpoint
uris as the service name.</p><p>In the example above, this would mean the service names would be defined as
if you add the following code yourself:</p><pre class="programlisting">zipkin.addServerServiceMapping(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:queue:inbox"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:queue:inbox"</em></strong>);
zipkin.addClientServiceMapping(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"http:someserver/somepath"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"http:someserver/somepath"</em></strong>);</pre><p>This is not a recommended approach, but gets you up and running quickly
without doing any service name mappings. However, when you have multiple
systems across your infrastructure, then you should consider using human-readable service names, that you map to instead of using the camel endpoint
uris.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-zipkin-camel-zipin-starter"></a>camel-zipin-starter</h2></div></div></div><p>If you are using&nbsp;Spring Boot then you can add
the&nbsp;<code class="literal">camel-zipkin-starter</code> dependency, and turn on zipkin by annotating
the main class with <code class="literal">@CamelZipkin</code>. You can then configure camel-zipkin
in the&nbsp;<code class="literal">application.properties</code> file where you can configure the
hostname and port number for the Zipkin Server, and all the other
options as listed in the options table above.</p><p>You can find an example of this in
the&nbsp;<a class="link" href="https://github.com/apache/camel/tree/master/examples/camel-example-zipkin" target="_top">camel-example-zipkin</a></p></div></div></body></html>