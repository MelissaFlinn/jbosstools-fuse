<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>LDIF Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="ldap-component.html" title="LDAP Component"><link rel="next" href="linkedin-component.html" title="Linkedin Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="ldif-component"></a>LDIF Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ldif-component.html#_uri_format_115">URI format</a></span></dt><dt><span class="section"><a href="ldif-component.html#_options_89">Options</a></span></dt><dt><span class="section"><a href="ldif-component.html#_body_types">Body types:</a></span></dt><dt><span class="section"><a href="ldif-component.html#_result_4">Result</a></span></dt><dt><span class="section"><a href="ldif-component.html#_ldapconnection">LdapConnection</a></span></dt><dt><span class="section"><a href="ldif-component.html#_samples_24">Samples</a></span></dt><dt><span class="section"><a href="ldif-component.html#LevelDB-LevelDB">LevelDB</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.20</strong></span></p><p>The <span class="strong"><strong>ldif</strong></span> component allows you to do updates on an LDAP server
from a LDIF body content.</p><p>This component uses a basic URL syntax to access the server. It uses
the Apache DS LDAP library to process the LDIF. After processing the LDIF,
the response body will be a list of statuses for success/failure of each
entry.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Apache LDAP API is very sensitive to LDIF syntax errors. If in doubt,
refer to the unit tests to see an example of each change type.</p></td></tr></table></div><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-ldif<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_115"></a>URI format</h2></div></div></div><pre class="screen">ldap:ldapServerBean[?options]</pre><p>The <span class="emphasis"><em>ldapServerBean</em></span> portion of the URI refers to a
<a class="link" href="https://directory.apache.org/api/gen-docs/latest/apidocs/org/apache/directory/ldap/client/api/LdapConnection.html" target="_top">LdapConnection</a>.
This should be constructed from a factory at the point of use to avoid connection timeouts. The LDIF component only supports producer
endpoints, which means that an <code class="literal">ldif</code> URI cannot appear in the <code class="literal">from</code> at
the start of a route.</p><p>For SSL configuration, refer to the <code class="literal">camel-ldap</code> component where there is an example
of setting up a custom SocketFactory instance.</p><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_89"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ldif-component.html#_path_parameters_1_parameters_118">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="ldif-component.html#_query_parameters_1_parameters_3">Query Parameters (1 parameters):</a></span></dt></dl></div><p>The LDIF component has no options.</p><p>The LDIF endpoint is configured using URI syntax:</p><pre class="screen">ldif:ldapConnectionName</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_118"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>ldapConnectionName</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The name of the LdapConnection bean to pull from the registry. Note that this must be of scope prototype to avoid it being shared among threads or using a connection that has timed out.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_1_parameters_3"></a>Query Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_body_types"></a>Body types:</h2></div></div></div><p>The body can be a URL to an LDIF file or an inline LDIF file. To signify the difference
in body types, an inline LDIF must start with:</p><pre class="screen">version: 1</pre><p>If not, the component will try to parse the body as a URL.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_result_4"></a>Result</h2></div></div></div><p>The result is returned in the Out body as a <code class="literal">ArrayList&lt;java.lang.String&gt;</code> object.
This contains either "success" or an Exception message for each LDIF entry.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_ldapconnection"></a>LdapConnection</h2></div></div></div><p>The URI, <code class="literal">ldif:ldapConnectionName</code>, references a bean with the ID,
<code class="literal">ldapConnectionName</code>. The ldapConnection can be configured using a
<code class="literal">LdapConnectionConfig</code> bean. Note that the scope must have a scope of
<code class="literal">prototype</code> to avoid the connection being shared or picking up a
stale connection.</p><p>The <code class="literal">LdapConnection</code> bean may be defined as follows in Spring XML:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ldapConnectionOptions"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.directory.ldap.client.api.LdapConnectionConfig"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ldapHost"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"${ldap.host}"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ldapPort"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"${ldap.port}"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"name"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"${ldap.username}"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"credentials"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"${ldap.password}"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"useSsl"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"false"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"useTls"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"false"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ldapConnectionFactory"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.directory.ldap.client.api.DefaultLdapConnectionFactory"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">index</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"0"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ldapConnectionOptions"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ldapConnection"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">factory-bean</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ldapConnectionFactory"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">factory-method</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"newLdapConnection"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">scope</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"prototype"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong></pre><p>or in a OSGi blueprint.xml:</p><pre class="screen">&lt;bean id="ldapConnectionOptions" class="org.apache.directory.ldap.client.api.LdapConnectionConfig"&gt;
  &lt;property name="ldapHost" value="${ldap.host}"/&gt;
  &lt;property name="ldapPort" value="${ldap.port}"/&gt;
  &lt;property name="name" value="${ldap.username}"/&gt;
  &lt;property name="credentials" value="${ldap.password}"/&gt;
  &lt;property name="useSsl" value="false"/&gt;
  &lt;property name="useTls" value="false"/&gt;
&lt;/bean&gt;

&lt;bean id="ldapConnectionFactory" class="org.apache.directory.ldap.client.api.DefaultLdapConnectionFactory"&gt;
  &lt;argument ref="ldapConnectionOptions"/&gt;
&lt;/bean&gt;

&lt;bean id="ldapConnection" factory-ref="ldapConnectionFactory" factory-method="newLdapConnection" scope="prototype"/&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_samples_24"></a>Samples</h2></div></div></div><p>Following on from the Spring configuration above, the code sample below
sends an LDAP request to filter search a group for a member. The Common
Name is then extracted from the response.</p><pre class="programlisting">ProducerTemplate&lt;Exchange&gt; template = exchange.getContext().createProducerTemplate();

List&lt;?&gt; results = (Collection&lt;?&gt;) template.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"ldap:ldapConnection, "</em></strong>LDiff goes here<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">");
</em></strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">if</strong> (results.size() &gt; <span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">0</span>) {
  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Check for no errors</em>

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">for</strong> (String result : results) {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">if</strong> (<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"success"</em></strong>.equalTo(result)) {
      <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// LDIF entry success</em>
    } <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">else</strong> {
      <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// LDIF entry failure</em>
    }
  }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="LevelDB-LevelDB"></a>LevelDB</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ldif-component.html#LevelDB-UsingLevelDBAggregationRepository">Using LevelDBAggregationRepository</a></span></dt><dt><span class="section"><a href="ldif-component.html#LevelDB-Whatispreservedwhenpersisting">What is preserved when persisting</a></span></dt><dt><span class="section"><a href="ldif-component.html#LevelDB-Recovery">Recovery</a></span></dt><dt><span class="section"><a href="ldif-component.html#LevelDB-Dependencies">Dependencies</a></span></dt><dt><span class="section"><a href="ldif-component.html#LevelDB-SeeAlso">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.10</strong></span></p><p><a class="link" href="https://code.google.com/p/leveldb/" target="_top">Leveldb</a> is a very lightweight and
embedable key value database. It allows together with Camel to provide
persistent support for various Camel features such as
Aggregator.</p><p>Current features it provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">LevelDBAggregationRepository</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="LevelDB-UsingLevelDBAggregationRepository"></a>Using LevelDBAggregationRepository</h3></div></div></div><p><code class="literal">LevelDBAggregationRepository</code> is an <code class="literal">AggregationRepository</code> which on
the fly persists the aggregated messages. This ensures that you will not
loose messages, as the default aggregator will use an in memory only
<code class="literal">AggregationRepository</code>.</p><p>It has the following options:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Option</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">repositoryName</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>A mandatory repository name. Allows you to use a shared <code class="literal">LevelDBFile</code>
for multiple repositories.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">persistentFileName</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Filename for the persistent storage. If no file exists on startup a new
file is created.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">levelDBFile</code></p></td><td align="left" valign="top"><p>LevelDBFile</p></td><td align="left" valign="top"><p>Use an existing configured
<code class="literal">org.apache.camel.component.leveldb.LevelDBFile</code> instance.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">sync</code></p></td><td align="left" valign="top"><p>boolean</p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.12:</strong></span> Whether or not the LevelDBFile should sync on write or
not. Default is false. By sync on write ensures that its always waiting
for all writes to be spooled to disk and thus will not loose updates.
See <a class="link" href="http://leveldb.googlecode.com/svn/trunk/doc/index.html" target="_top">LevelDB docs</a>
for more details about async vs sync writes.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">returnOldExchange</code></p></td><td align="left" valign="top"><p>boolean</p></td><td align="left" valign="top"><p>Whether the get operation should return the old existing Exchange if any
existed. By default this option is <code class="literal">false</code> to optimize as we do not need
the old exchange when aggregating.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">useRecovery</code></p></td><td align="left" valign="top"><p>boolean</p></td><td align="left" valign="top"><p>Whether or not recovery is enabled. This option is by default <code class="literal">true</code>.
When enabled the Camel Aggregator automatic
recover failed aggregated exchange and have them resubmitted.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">recoveryInterval</code></p></td><td align="left" valign="top"><p>long</p></td><td align="left" valign="top"><p>If recovery is enabled then a background task is run every x&#8217;th time to
scan for failed exchanges to recover and resubmit. By default this
interval is 5000 millis.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">maximumRedeliveries</code></p></td><td align="left" valign="top"><p>int</p></td><td align="left" valign="top"><p>Allows you to limit the maximum number of redelivery attempts for a
recovered exchange. If enabled then the Exchange will be moved to the
dead letter channel if all redelivery attempts failed. By default this
option is disabled. If this option is used then the <code class="literal">deadLetterUri</code>
option must also be provided.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">deadLetterUri</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>An endpoint uri for a Dead Letter Channel
where exhausted recovered Exchanges will be moved. If this option is
used then the <code class="literal">maximumRedeliveries</code> option must also be provided.</p></td></tr></tbody></table></div><p>The <code class="literal">repositoryName</code> option must be provided. Then either the
<code class="literal">persistentFileName</code> or the <code class="literal">levelDBFile</code> must be provided.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="LevelDB-Whatispreservedwhenpersisting"></a>What is preserved when persisting</h3></div></div></div><p><code class="literal">LevelDBAggregationRepository</code> will only preserve any <code class="literal">Serializable</code>
compatible message body data types. Message headers must be primitive /
string / numbers / etc. If a data type is not such a type its dropped
and a <code class="literal">WARN</code> is logged. And it only persists the <code class="literal">Message</code> body and the
<code class="literal">Message</code> headers. The <code class="literal">Exchange</code> properties are <span class="strong"><strong>not</strong></span> persisted.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="LevelDB-Recovery"></a>Recovery</h3></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ldif-component.html#LevelDB-UsingLevelDBAggregationRepositoryinJavaDSL">Using LevelDBAggregationRepository in Java DSL</a></span></dt><dt><span class="section"><a href="ldif-component.html#LevelDB-UsingLevelDBAggregationRepositoryinSpringXML">Using LevelDBAggregationRepository in Spring XML</a></span></dt></dl></div><p>The <code class="literal">LevelDBAggregationRepository</code> will by default recover any failed
Exchange. It does this by having a background tasks
that scans for failed Exchanges in the persistent
store. You can use the <code class="literal">checkInterval</code> option to set how often this task
runs. The recovery works as transactional which ensures that Camel will
try to recover and redeliver the failed Exchange.
Any Exchange which was found to be recovered will be
restored from the persistent store and resubmitted and send out again.</p><p>The following headers is set when an Exchange is
being recovered/redelivered:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">Exchange.REDELIVERED</code></p></td><td align="left" valign="top"><p>Boolean</p></td><td align="left" valign="top"><p>Is set to true to indicate the Exchange is being
redelivered.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Exchange.REDELIVERY_COUNTER</code></p></td><td align="left" valign="top"><p>Integer</p></td><td align="left" valign="top"><p>The redelivery attempt, starting from 1.</p></td></tr></tbody></table></div><p>Only when an Exchange has been successfully
processed it will be marked as complete which happens when the <code class="literal">confirm</code>
method is invoked on the <code class="literal">AggregationRepository</code>. This means if the same
Exchange fails again it will be kept retried until
it success.</p><p>You can use option <code class="literal">maximumRedeliveries</code> to limit the maximum number of
redelivery attempts for a given recovered Exchange.
You must also set the <code class="literal">deadLetterUri</code> option so Camel knows where to
send the Exchange when the <code class="literal">maximumRedeliveries</code> was
hit.</p><p>You can see some examples in the unit tests of camel-leveldb, for
example
<a class="link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-leveldb/src/test/java/org/apache/camel/component/leveldb/LevelDBAggregateRecoverTest.java" target="_top">this
test</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="LevelDB-UsingLevelDBAggregationRepositoryinJavaDSL"></a>Using LevelDBAggregationRepository in Java DSL</h4></div></div></div><p>In this example we want to persist aggregated messages in the
<code class="literal">target/data/leveldb.dat</code> file.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="LevelDB-UsingLevelDBAggregationRepositoryinSpringXML"></a>Using LevelDBAggregationRepository in Spring XML</h4></div></div></div><p>The same example but using Spring XML instead:</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="LevelDB-Dependencies"></a>Dependencies</h3></div></div></div><p>To use LevelDB in your camel routes you need to add
the a dependency on <span class="strong"><strong>camel-leveldb</strong></span>.</p><p>If you use maven you could just add the following to your pom.xml,
substituting the version number for the latest &amp; greatest release (see
the download page for the latest versions).</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-leveldb<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>2.10.0<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="LevelDB-SeeAlso"></a>See Also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li><li class="listitem">Aggregator</li><li class="listitem">HawtDB</li><li class="listitem">Components</li></ul></div></div></div></div></body></html>